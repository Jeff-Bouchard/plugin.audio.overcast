version: 2
jobs:
   build:
      docker:
         - image: circleci/python:2
      working_directory: ~/plugin.audio.opencast
      steps:
         - checkout
         - run:
            name: Create release
            command: |
                export ADDON_VERSION=`grep -w id addon.xml | cut -d\" -f6`
                if [[ ${CIRCLE_BRANCH} == "master" ]]
                then
                  export POSTFIX=""
                else
                  export GIT_LAST_COMMIT=`git rev-parse --short=7 HEAD`
                  export POSTFIX="-$(echo ${CIRCLE_BRANCH} | sed 's/\//_/g')-${GIT_LAST_COMMIT}"
                fi
                cd ..
                mkdir release
                zip -r ~/release/plugin.audio.opencast-${ADDON_VERSION}${POSTFIX}.zip plugin.audio.opencast -x "*.git/*" "*.gitignore" "*.circleci/*"
         - store_artifacts:
            path: ~/release/
            destination: /release/
